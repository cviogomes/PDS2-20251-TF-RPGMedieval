#include "Combate.hpp"
#include "Utils.hpp"
#include <iostream>
#include <limits>
#include <vector>

// Esta é a nova e aprimorada função lutar.
// Ela usa um loop 'while' para poder adicionar novos inimigos (como os Slimes divididos) no meio do combate.
void lutar(Jogador& jogador, std::vector<std::unique_ptr<Inimigo>>& inimigos) {
    
    // O loop continua enquanto houver inimigos na lista e o jogador estiver vivo.
    while (!inimigos.empty() && jogador.estaVivo()) {
        
        // Pega o primeiro inimigo da fila para o combate atual.
        auto& inimigo = inimigos.front();

        // Mostra o nome e a arte ASCII do inimigo que apareceu.
        battlePrint("\n" + inimigo->getNome() + " apareceu!\n");
        if (inimigo->getNome() == "Zumbi"){
            std::cout << R"(
                                                          ######--                                              
                                      ########--::--@@++::--##                                      
                                  ..++------MM++::::##++::::::++####--                              
                              @@@@##mm::++::mm++--++::MMmm++##::--  --##                            
                          ##..--::++##mmmm++++mm@@MMmm----::++++::------::                          
                        ##::--++mm::--mm::::++::::##++::::mmmm::MM::::::##                          
                      ++mm::::++::::::##::mm++@@####mmmmmmmm::::..@@mmmm##MM##mm                    
                      MMmm++::++mm::::##::::##::::::##--::mm++++::##mmmmMM::----                    
                      ::mmmmmm::mm++mm##@@##mmmm++##----++++mmmmmmmm++@@mm::::::MM                  
                  --MM--::++++MM@@######mmmmmmmm##mm::::::::mm####::::mmmmmmmmmm                    
                  ++--::@@::::::mmmmMM@@MMmmmm####@@mmMMMM@@::@@mmMM++++++@@mm++##                  
                ##::::##::::::::##@@####@@##++..    ++@@mm::++MM++mm@@::::::++::--##                
                ##++++##mmmm@@mm##@@  @@mm::::::------  MM####mmmm##mm##MMmm++##::##MM              
              ####mmmm####++  ####  ----MMMM::------MM----::--::..  MMMM++::::MMmm####              
              ##MM######  ..::@@----::::::--::------::::::------mmMM--::####mm@@mmmm##::##          
              ##..@@@@  ::--::::MM--::::::::::------------::::----::----..  ##@@@@####..++          
              ##++++..------++++----::------------------------------------::..    ..mmmm            
            --@@mm::::++--::--::--::::--::::::::----------++::--------::--::----::--mmmm            
            MM##++--::##::----------------::MMmmmm++@@++--::----::------------MM----++mm::          
            @@##::::MM##--::::--------++++------..----::--++##mm----::----::----::--##mm##          
            @@##::--::MMMM::--......----::--MM@@@@@@@@MM::----::--::::::::::--++--@@MM++--          
            mm@@::--mm++--..--::--..    ..::----::--::::----::--            ::##--::++mm            
              MM::::MM::--::::::--------    ::----::::--::--    ..------::::::++@@::mm##            
              ##mm##mmmmMMmmmm@@::mm------  --##----mmmm--  ------::++@@mmmmmmmmMM++mm##            
              mmmm##mm##########MM@@mm++--::--------++------::++mmmmmmmm####MMmmmm@@MM              
                ##MM##mm..        ######mmmm++mm##@@##----::mmMM@@####MM--::##mmMMmm##              
                ++mmmmMM              ####mmmmmm####@@mmmm++mm##++          --mmMMmm                
        @@######  @@##mm                ::##mmmm##mm##mmmm##::              ..::MM##  ..##::        
      ##..::----mm##MM::--              --::@@MMMM++##mm##--                mm::##mm##  --  ##      
      MM++MM@@mm::@@::::@@              ..######@@--::####                  @@--MM##----mm++--##    
      --##mm####@@##::::mm##            ##@@mm##  ::..----##              ##++--mm##mm######mm##    
    ..##mm##########--  --@@++########++##::mm--##::##::--++mm##      @@##++::--MM########mmMM@@    
      mmMM##@@@@--##MM--  ::--mmmm::##::::--++####++####::--::##++MMMM####::--##MM@@::##@@MMmm##    
      ##mm@@@@##--mm##@@::::----::--------::--####MM####----::--::mm--::--::@@####::::####mmmm##    
      ##mm######mmmm####mm----------------::::####--####::--------::--::::--MM####mm::##@@##mm##    
        ##mm##@@####MM##MM::++::--------::::::##@@##--##MM----------++##::mm@@##@@####MM##mm##      
        MMmm++::MM##mm####mm##++mm------------++::++::--::::--::mmmmmmMMMMmm##@@@@mmmm++mmMMmm      
          @@mm++mmmm##@@##MMmm@@..mm::----------------------++##MMmm@@++mmMM##@@mmMM::++mm##        
            --####@@@@####MM::..  ##mmMM--..mm..::::--::@@mmmm##  ##@@::--######@@mm++####          
                  ..      @@::..  ##MM  @@::mm++::@@::MM####  ##  ##MM::@@##..@@####@@              
                          ##--::##  @@  ##mm  @@..  ########  ##  ##@@----@@                        
                          ##----MM  ++  ..    ##    --######  ::  ##@@::::##                        
                          ##++--mm##MM  ##    ..      ####++  MM####@@::MM##                        
                          @@MM--++####  ..######      ################::--##                        
                          ::----++####################################::++##                        
                        ##::::--++####################################::##@@                        
                      ::mm++----############################    ######--MM::..                      
                        ##mm@@--######  mm##################mm  MMMM##--++::##                      
                          ##++--####MM  mm  MM################++MMmm##--@@@@@@                      
                            ##::--MMmmMM    ##  ####MM########@@@@MM##--::mm##                      
                              ##--++@@mmmm  mm  ##    ::######MM@@##--@@++##                        
                                ##--++@@####MM--##--  ######MM##MM--++++@@                          
                                --mm::::##MMmmmmmmMM++mmMM##::  ----mm++                            
                                  ##::--  --@@@@########mm  --::--++@@                              
                                  --mm::--::--..--....----------++##                                
                                    ##mm++::----------::----::++mm--                                
                                    --mm++mmmm++##mm::++++++mmmm##                                  
                                      ##mmmm++##@@  ##mmmmmmMM##                                    
            )" << "\n";
        } 
        else if (inimigo->getNome() == "Esqueleto"){
            std::cout << R"(
                                         _.--""-._                     
  .                         ."         ".                   
 / \    ,^.         /(     Y             |      )\|           
/   `---. |--'\    (  \__..'--   -   -- -'""-.-'  )         
|        :|    `;   '.     l_..-------.._l      .'          
|      __l;__ .'      "-.__.||_.-'v'-._||`"----"            
 \  .-' | |  `              l._       _.'                   
  \/    | |                   l`^^'^^'j                     
        | |                _   \_____/     _                
        j |               l `--__)-'(__.--' |               
        | |               | /`---``-----'"1 |  ,-----.      
        | |               )/  `--' '---'   \'-'  ___  `-.   
        | |              //  `-'  '`----'  /  ,-'   I`.  \|  
      _ L |_            //  `-.-.'`-----' /  /  |   |  `. \|  
     '._' / \         _/(   `/   )- ---' ;  /__.J   L.__.\ :
      `._;/7(-.......'  /        ) (     |  |            | |
      `._;l _'--------_/        )-'/     :  |___.    _._./ ;
        | |                 .__ )-'\  __  \  \  I   1   / / 
        `-'                /   `-\-(-'   \ \  `.|   | ,' /  
                           \__  `-'    __/  `-. `---'',-'   
                              )-._.-- (        `-----'      
                             )(  l\ o ('..-.                
                       _..--' _'-' '--'.-. |                
                __,,-'' _,,-''            \ \\|                
               f'. _,,-'                   \ \\|               
              ()--  |                       \ \\|              
                \.  |                       /  \\|             
                  \ \                      |._  |           
                   \ \                     |  ()|           
                    \ \                     \  /            
                     ) `-.                   | |            
                    // .__)                  | |            
                 _.//7'                      | |            
               '---'                         j_| `          
                                            (| |            
                                             |  \|           
                                             |lllj          
                                             ||||| 
            )" << "\n";
        }
        else if (inimigo->getNome() == "Vampiro"){
            std::cout << R"(
                                       ..######################                                      
                                  ..##mm                      ####                                  
                                MM##                              ##::                              
                              ..##                                  ##                              
                              ##        mm                            ##                            
                              ##    ##mm..mm##        mm##mmmm##::    ##                            
                            ..++  ##          ##    --##        ##..  mm                            
                            ##  @@++          ..##  ##            ##  mm                            
                        ::  ##  ##              MM##              MM::mm  MM                        
                        ######--++                                  ##mm##mm..                      
                        ##  ####                                    ####  ::--                      
                        ##    ##                                    ##    ++..                      
                        ##    ##    @@####--              ######    ##    @@                        
                        ##    ##    mm    @@####    --####      ##  ##    ##                        
                        ##    ##    ##        ##    ##..      ##--  ##    ##                        
                        ..##  ##      ########..      ########..    ##    @@                        
              ####MMMMMMMM##++##                                    ##..##############@@            
                ##          --##                                    ####            ##              
                  ##          @@                                    ##            ##                
                    ##        --mm                                  ##          ##                  
                    --##        ##        ##################      @@--        ##                    
                      mm@@      MM++       ##            ##        ##        @@++                    
                        ##--      ##                            ##        --##                      
                          ##        ##                        ##::        ##                        
                            ##        ##MM                  ####        ##                          
                              ##      MM######--    ..MM##@@##        ##                            
                              ##        ##    --MM@@::..  ##          ##                            
                              mm          ##            mmmm          MM                            
                            ##            ##            ##            ..@@                          
                            ##              ##        ##                ##                          
                            ##              ##      MM::                ##                          
                            ##                ##    ##                  ##                          
                          MM                  ##  ##                    ::++                        
                          ##                  mm##--                      ##                        
                          ##                    ##                        ##                        
                          ##                    ##                        ##                        
                        --::                    ##                        mm..                      
                        ##                      ++--                      ..mm                      
                        ##                        ##                        ##                      
                        ######################################################                      

            )" << "\n";
        }
        else if (inimigo->getNome() == "Aranha"){
            std::cout << R"(
            $               $           
          $$                 $$         
         $$                   $$        
        $$                     $$       
        $$                     $$       
        $$                     $$       
         $$                   $$        
     $$  $$                   $$  $$    
    $$   $$                   $$   $$   
   $$     $$                 $$     $$  
   $       $$$             $$$       $  
   $$       $$$           $$$       $$  
   $$$       $$$  $$$$$  $$$       $$$  
    $$$$$$    $$$$$$$$$$$$$   $$$$$$$   
         $$$$$$$$$$$$$$$$$$$$$$         
    $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$    
   $$$ $$$$$$$$$$$$$$$$$$$$$$$$$$ $$$   
  $$$         $$$$$$$$$$$$         $$$  
 $$         $$$$$$$$$$$$$$$$$        $$ 
 $$     $$$$$$$$$$$$$$$$$$$$$$$$     $$ 
$$     $$$  $$$$$$$$$$$$$$$$  $$$     $$
 $$    $$   $$$$$$$  $$$$$$$   $$    $$ 
  $    $$   $$$$$$$  $$$$$$$   $$    $  
   $   $$   $$$$$$$$$$$$$$$$   $$   $   
    $  $$    $$$$$$$$$$$$$$    $$  $    
       $$     $$$$$$$$$$$$     $$       
       $$       $$$$$$$$       $$       
        $$                    $$        

            )" << "\n";
        }
        else if (inimigo->getNome() == "Lobisomem"){
            std::cout << R"(
            ####################################################################################################
####################################################################################################
##########################################@@..          ..##########################################
####################################::                          @@##################################
################################..                                  @@##############################
##############################                                          ############################
##########################mm                                              ##########################
########################::                            ++@@                  @@######################
######################mm                            ##::##                    ######################
####################@@                              ########                    ####################
####################                                ##########                    ##################
##################::                                ##########--                  MM################
##################                                  ############                    ################
################::                                  ##########::                    @@##############
################                                  @@############                      ##############
################                                ################@@                    ##############
##############++                              ..##################                    ##############
##############..                              ++##################                    mm############
##############                                MM##################                    --############
##############                                ####################--                  --############
##############              ++..##            ######################                  --############
##############          ..MM++--mmmm      mm##############    --####                  --############
##############              ++++########################        ######::              ::############
##############::                          --############          ######              ##############
##############@@                        ################          mm####..  mm        ##############
##############@@                    ..##################            ++######::        @@############
################                    ####################              MM####++::    ++##############
##############@@@@                ############  ########                ####@@--    ################
################@@              ##########--    ++######MM                MM      --@@##############
################@@@@          ##########        MM######@@                        ##################
################@@##--        MM########--      ############                    MM@@################
################@@@@@@            ++######..    ############--                --@@@@################
##################@@@@@@              ..####    ##..    MM####              ..@@@@@@################
##################@@@@@@@@            mm##::    @@        MM####          ..@@@@@@##################
################@@@@@@@@@@@@..        ####        ::        ####        ::##@@@@@@##################
########@@@@@@@@@@@@@@@@@@@@@@MM    ####..                  ####      @@@@@@@@@@@@@@@@##############
######@@@@@@@@@@@@@@@@@@@@@@@@@@######MM                    ####--MM@@@@@@@@@@@@@@@@@@@@############
@@@@@@@@@@@@@@@@@@@@@@@@@@@@############::                  ########@@@@@@@@@@@@@@@@@@@@@@@@@@######
@@@@@@@@@@@@@@@@@@@@@@@@@@######################################################@@####@@@@@@@@######
            )" << "\n";
        }
        else if (inimigo->getNome() == "Slime"){
            std::cout << R"(
                                                            ++####MM                                            
                                          ####################..                                    
                                      ############################                                  
                                    ######..  MM####################..                              
                                  ######      ########################..                            
                                ######      ############################                            
                              ########  ::################################                          
                              ######..####################################++                        
                            ########++######################################                        
                            ################################################..                      
                          --##########--  MM################mm  ##############                      
                          ##########        ::############..      MM##########                      
                          ########MM          ##########@@          ##########                      
                          ########              ########            MM########                      
                          ########      mm      ########      ####    ########                      
                          ######@@      ##MM    ########      ####    ########                      
                          ######::    mm####    ########    ######++  ########--                    
                          ##@@##..  ########    ######mm    ######mm  ########@@                    
                        mm######..  ########    ######MM    ######++  ######mm##                    
                        ##MM####MM  ########    ########    ######::  ######  ##                    
                      mm##--######  ######@@    ########    ######    ######..##MM                  
                    MM##  ########  MM####    ..########    ######  @@########  ##..                
                @@####  MM########--  ####    ##########++    ..    ##########::  ##++              
          ########    ++############        ::############        @@############MM  ####            
    MM####@@..      ##################..  ++################::::####################    MM####      
  ####::      --########################################################################    ..####  
::##      ::########mm--mm################################################@@        @@######    ::##
####      ################@@..    mm@@######################MM    @@##::++##################--    ##
  ##..  ++####::          MM####@@            --::----    ##      ######::            ..######    ##
    ##++  ####                ++########                --########MM                      ##..  ##::
      MM######  ##########        MM############----mm########++          --++@@MM--      ######    
            ##  @@##  ::####++        --##################--        mm########----######  ####      
          ##..    ##      ..####              --@@MM..          MM########--        ####    ##MM    
      ..##        ..##        ####                            ############          ##        ##MM  
      ##            ##--        ##::                        ######@@::##          ####          ##::
    ++##            ####        MM##                      ######..    ##          ####          ####
    ::##          --####          ##::                  ######::      ##          ####          ####
      ####..    mm######          @@##                ++######        ##          ####MM      ######
      --##############            ..##                ######--        ##          ################--
          ##########mm              ##              MM######          ##          ##  ##########    
                    ##::            ##              ####::##--        ##          ##                
                    ##@@            ##            ::####  ##MM        ##          ##                
                                    ##            ####    ##mm        ##--        ++                
                                  --##            ##::    mm          ##MM                          
                                  MM##          ..##                  ####                          
                                  ######        ####                  ####                          
                                  ######        ##MM                ++####                          
                                  ######        ##mm                mm####                          
                                  ####++      --##mm                  ####                          
                                    mm        ####MM                  ::                            
                                              ######                                                
                                              ######                                                
                                              ######                                                
                                              ######                                                
                                              ####mm                                                
            )" << "\n";
        }
        else if (inimigo->getNome() == "Goblin"){
            std::cout << R"(
                                                                                                                
                                                              MM                                    
                                                          --@@    ##                                
                                                @@    --##--      ##                                
                                              MM    ####..  ##MM  ####                              
                                            @@##MM####++    ####  ####                              
                                          ############    ######  ####                              
                                        ############MM  ########MM####                              
                                  --  ##############++  ##############                              
                                mmmm################mm################  ::                          
                              --##MM##################################..mm                          
                              ##########################################++                          
                            ::##########################################..                          
                            --############################################                          
                            ##############################################                          
  ::MM####@@--              ####  @@################################..####              --MM####MM::
        ::..--####@@        ####    ################################  ####        MM####++  MM      
            ####  ######    ####      ############################    ####..  MM####..::##--        
              ####MM  ####mm####--    ..########################::      ##::####....####MM          
              ####::##    ####--++      ::####################--  ..++  ####@@  ##++####            
                ##  ::@@    ######    ..  --################    mm  mm####    ##  ::####            
                ##mm  ####  ####  ++..--  mm  ##########..MM  MM  ..  ####  ####    ##              
                  @@  ######mm########mmmm..##++@@mm##::##  ##  ######  ##::####..##                
                      --####--  ########@@mm@@..######::MM##  ######--  mm######                    
                      ++######        ####MMMM##--      ##..####        ::####  --                  
              --  --####..::##  --####@@mm####::########..####::@@##mm  ::mm  mmMM  @@              
            ::--########..  ++    ####  ######@@  MMMM  ######mmMM####        ######  ##            
        mm  ##--##########  ..    @@##  --::######mm######mm::++++##    ..  ::########@@##          
      --  ################mm##  ..  ################++############@@MM  ##############  ##  ##      
      ##  ##  ##################    --##--##  ++++##mm::--..++  MM    ####::##########..######::    
    MM##--########################++      ##..##mm####++  ##        ######  ####################    
    ####--##############::######mm    ####--@@--########  ######  ##--####--####################    
    ####::##############..########    MM##::  @@--mm--##++  ##mm--  ::####mm####################    
    ####################--########..mm  ##++@@##  ####MM##++####--  MM####################::####    
    ####################MM########@@    MMMM      ..  ..MM++####..##++##########################    
    ##################################    ..@@  ::mm..######  ##--##MM##########################    
    @@##########################::####..##::  ..######@@        ################################    
    ..########################::  ######  ##  --##@@@@##  ..::@@##  ############################    
  ::..####################################  ##############++##################################::##  
  ################################--########    ######    ..####mm############################mm##  
  ################++  ######################::  ########  ####::##############..  ################  
  ################      ##############mm######@@############  ##############      --##############::
  ##############        ################@@++@@####--######::################        @@############++
  ############          ######################--@@  mm####################            @@##########++
  ##########            ::  ############################################MM..            mm########++
  ######MM                  ++########################################@@                    ######MM
::++++                        ########################################mm                      mmmmmm
                            mm  MM######MM##########################--mm                            
                                  @@##############################                                  
                                  ::@@############################                                  
                                    ############################                                    
                                      ########################..                                    
            )" << "\n";
        }
        else if (inimigo->getNome() == "Bruxa"){
            std::cout << R"(
                                                                                                                
                                                                            MM##..                  
                                                                        --####                      
                                                                      ::####..                      
                                                                      ####@@                        
                                                                    ######..                        
                                                                  ..######                          
                                                --                ++######                          
                                                  ##              ########                          
                                                  ####            ########                          
                                                  ####++          ########                          
                                                  ######          ########                          
                                              ##############      @@######++                        
                    ..##....++                  mm######@@        --########                        
                    ############mm..++mm::    ++########@@          ##########                      
                    ######################mm@@########@@..          ::##########                    
                  ..##############################@@  ##              @@##########--        ..      
                  ############--  ##  ..##########MM                    @@##################--      
            mm##@@########  mm        ##############                      --##############          
            @@########MM--          ################                          ..------              
            ##########          ++####################++                                            
            ##########        ################  mm##########::..::  --@@mm                          
            ##########..      ##################@@mm################                                
      ::########@@            ####################MM@@########@@  MM                                
        ########              ##############################                                        
      ++  ####..                ####################::MM####                                        
      ..####++                  ..##################--  ##..                                        
        ##########::      --MM########################                                              
        ..##################MM      ##############++mm                                              
          ##############mm            ######..  ##                                                  
            ##########..                ####  --##                                                  
            ######--                      ##----..##mm                                              
                                          ##++                                                      
                                          MM++                                                      
                                            @@                                                      
            )" << "\n";
        else if (inimigo->getNome() == "Seraphina, Cavaleira da Peste"){
            std::cout << R"(
                                                      _
                                        ,;;;
                                      .;;||:.
                                     :;;|||::
                                   ,;;;;;||::.
                                  ,;;;;;||||||:.
                                 ,;;;;|||||||||||.
                                ,;;;||!!!!!!!|||||.
                               ,;;;;|!!!!!!!!!|||||
                               ;;;;!!!!!!!!!!!!|||||
                              |;;;;;/~\!!!,'~\!!||||
                             :;;;;;|   |!!|   |!!|||
                             :;;;;;;-._;!!`._/!!!!|`.
                             |;;;;;;|||!!;;;!!||!!|||
        ____                  |;;;;;|||!!;;;|||!!||,'
      ,- _ _`,                 |;;;|||!!!;;|||!!||/ ~-.__
    /'/~; ; ; )             _--`;;;|||!!!;;|||!!,' "" __.--.\|
   | ( .---~~--._       _.-~:"" `:;|||!!;;;|||/' ".-~~      `.\|
   `. ((.;~---._ `-.  ,'     :""  `:|!!;;;;/' "  ;            :|.
    : ((;##### `-. :,'       :""""  |!!;;;/ "" .'  __         ;||
     :   #####| `;  `-._     :""""  ||!!;/ "" .' .'          ,:||
      |   ###  | `.     `-._:"""""  `!!!:  "  :              ';||
      |   ###   .  `-.      `-._____.----'~~~`'`.           '|"|
     |    ###   :    `.                         ;          .'"||
     |    ###   ;     `._                                .'"|||
     |    ###  |     ,-' `-._         _                 / "||||
      |   ###     ,-'    |"  `-._      `-.            ,' "|||:|
      |   ###   ,'       |""     `-.___   `.       _/   "|||:::|
       `_ ###_.'         |"""""        `---'-____.'    """||||||
          ###            `.""""""""""""             """""""||||
          ###             |""" """""""""""""""""""""""|||""""|
          ###             |"""""" """""""""""""""""""|||"""""|
          ###             `.""""""""""""""""""""""""""""""__|
          ###              `.""""""""""""""""""""____.---'   \|
   /|     ###               `."""""""""____.----'    //-\    |\|
 .||      ###                `--.__,--' //|| \\     //   \  //~|
 ||:      ###                / /\ \    // ||  \\   //     \// :|
 |||.     ###               / /  \ \  //  ||   \\ //____.-/  :: \|
 |||||.   ###              //_____\ \//   ||    \\/       ::  ::||
 |||||||  ###              ~~|     ~~\____/~\_.-~~  :::       ::||
 |||||||| ###                `.                              ::|||
 |||||||||||||.   |          ||                               :|||
 ||||||||||||||||||          |||                     : ___   ::`||
 ||||||||||||||||||          `||:: `._             _.-':::::::::||
 ||||||||||||||||||           |||||   `-._     _.-'       ::::::|'
 ||||||||||||||||||           |||||::     `\/~'              ::|'
 |||||||||||||'   |           `||||:        \                  |
 |||||||  ###                  ||::::        |                 |
 |||||/~~~~~~~~~.              `||:::         |               |'
 ||||   /\   /\  `.             ||::::         |              |
 ||| :  ~~ II~~ :  |            ||:::::        |             |'
 ||  : ________ :  |            `||:::::       |             |
 ||    \##_#_#/   .'             |||:::::      |             |
  \| ____________'
            )" << "\n";
        }
        else if (inimigo->getNome() == "Vorstag, Cavaleiro da Fome"){
            std::cout << R"(
                                       /\|
                      .-_-.           /  \|
             ||   .-.(    .' .-.   // \  /
              \\\/ (((\   /)))  \ / // )( 
               ) '._  ,-.   ___. )/ //(__) 
               \_((( (  :)  \)))/ ,  / ||
                \_  \ '-' /_   /| ),// ||
                  \ (_._.'_ \ (o__//  _||_ 
                   \ )\  .(/ /  __)   \   \|
                   ( \ '_  .'  /(      |-. \|
                    \_'._'.\__/))))    (__)'.'.  
                   _._   |  |    _.-._ ||   \ '.
                  / //--'  / '--//'-'/\||____\  '.
                  \---.\ .----.//  //  ||//  '\   \|
                 /   ' \/    ' \\__\\ ,||\\_______.'
                 \\___//\\____//\____\ ||
      _.-'''---. /\___/  \____/  \\/   ||
   ..'_.''''---.|   /.  \        /     ||
 .'.-'O    __  /  _/  )_.--.____(      ||
/ / /  \__/  /'  /\ \(__.--._____)     ||
| |    /\ \  \_.' | |   \      |       ||
\  '.__\,_.'.__/./ /     ) .   |\      ||
 '..__ O --' ___..'     /\     /|'.    ||
      ''----'           | \/\.' / /'.  ||
                        |\(()).' /   \ ||
                      _/ \ \/   /     \||
              __..--''    '.   |      |||
          .-''            / '._|/     |||
         /                __.- /      /||
         \   ____..-----''    /      | ||
          '.     )).         |       / ||
            ''._//  \        .-----./  ||
                '.   \      (.-----.)  ||
                  '.  \      |    /    ||
                    )_ \     |   |     ||
                   /__'O\    ( ) (     ||
     _______mrf,-'____/|/__   |\  \    ||
                              |    |   ||
                              |____)  (__)
                              '-----'  ||
                               \   |   ||
                                \  |   ||
                                 \ |   ||
                                  | \  ||
                                  |_ \ ||
                                  /_'O\|| 
                               .-'___/(__)
            )" << "\n";
        }
         else if (inimigo->getNome() == "Thargon, Cavaleiro da Guerra"){
            std::cout << R"(
                           __.--|~|--.__                               ,,;/;
                         /~     | |    ;~\          	            ,;;;/;;'
                        /|      | |    ;~\\                      ,;;;;/;;;'
                       |/|      \_/   ;;;|\                    ,;;;;/;;;;'
                       |/ \          ;;;/  )                 ,;;;;/;;;;;'
                   ___ | ______     ;_____ |___....__      ,;;;;/;;;;;'
             ___.-~ \\(| \  \.\ \__/ /./ /:|)~   ~   \   ,;;;;/;;;;;'
         /~~~    ~\    |  ~-.     |   .-~: |//  _.-~~--,;;;;/;;;;;'
        (.-~___     \.'|    | /-.__.-\|::::| //~     ,;;;;/;;;;;'
        /      ~~--._ \|   /          `\:: |/      ,;;;;/;;;;;'
     .-|             ~~|   |  /V""""V\ |:  |     ,;;;;/;;;;;' \
    /                   \  |  ~`^~~^'~ |  /    ,;;;;/;;;;;'    ;
   (        \             \|`\._____./'|/    ,;;;;/;;;;;'      '\
  / \        \                             ,;;;;/;;;;;'     /    |
 |            |                          ,;;;;/;;;;;'      |     |
|`-._          |                       ,;;;;/;;;;;'              \
|             /                      ,;;;;/;;;;;'  \              \__________
(             )                 |  ,;;;;/;;;;;'      |        _.--~
 \          \/ \              ,  ;;;;;/;;;;;'       /(     .-~_..--~~~~~~~~~~
 \__         '  `       ,     ,;;;;;/;;;;;'    .   /  \   / /~
 /          \'  |`._______ ,;;;;;;/;;;;;;'    /   :    \/'/'       /|_/|   ``|
| _.-~~~~-._ |   \ __   .,;;;;;;/;;;;;;' ~~~~'   .'    | |       /~ (/\/    ||
/~ _.-~~~-._\    /~/   ;;;;;;;/;;;;;;;'          |    | |       / ~/_-'|-   /|
(/~         \| /' |   ;;;;;;/;;;;;;;;            ;   | |       (.-~;  /-   / |
|            /___ `-,;;;;;/;;;;;;;;'            |   | |      ,/)  /  /-   /  |
 \            \  `-.`---/;;;;;;;;;' |          _'   |T|    /'('  /  /|- _/  //
   \           /~~/ `-. |;;;;;''    ______.--~~ ~\  |u|  ,~)')  /   | \~-==//
     \      /~(   `-\  `-.`-;   /|    ))   __-####\ |a|   (,   /|    |  \
       \  /~.  `-.   `-.( `-.`~~ /##############'~~)| |   '   / |    |   ~\
        \(   \    `-._ /~)_/|  /############'       |X|      /  \     \_\  `\
        ,~`\  `-._  / )#####|/############'   /     |i|  _--~ _/ | .-~~____--'
       ,'\  `-._  ~)~~ `################'           |o| ((~>/~   \ (((' -_
     ,'   `-.___)~~      `#############             |n|           ~-_     ~\_
 _.,'        ,'           `###########              |g|            _-~-__    (
|  `-.     ,'              `#########       \       | |          ((.-~~~-~_--~
`\    `-.;'                  `#####"                | |           "     ((.-~~
  `-._   )               \     |   |        .       |  \                 "
      `~~  _/                  |    \               |   `---------------------
        |/~                `.  |     \        .     |  O    __.---------------
         |                   \ ;      \             |   _.-~
         |                    |        |            |  /  |
          |                   |         |           |/'  |

            )" << "\n";
        }
            else if (inimigo->getNome() == "Moros, Cavaleiro da Morte"){
            std::cout << R"(
                                              .-.
                                          .-.( ; )-.
                                         ( ;(); ).-.)
                                        ( ; )(:)( ; )
                                         (:)   ( ; )
                                                (:)
                                             .-'._.`-.
                                            /         `.                 _,,...._
                                            | /`-.     .                |```````.```-.
                                            | |   `.__.|                |           `-.`.
                                            | |   == \=|                |              `.\
                               .--.---'-----\  \     //                 |                \\_
                             .'    `.\ _:,----. \    /------.           |         __..---''
                           .'        )) /.     \ \__/ / \    `.          __..---''_..--''-''
                         .'         // ,'       `----'  |      \__..,--''__...--''       ||
                       .'          ; : |           |   _....--''  _...--''   .-.         ||
                      /-         .' |_ \       __..--''  _,.,..--':   |     / .(_\       ||
                     /_.+-+-+..___ .' `-,._.-''  _,..---'.         `.+.+ +.+  ) / )      ||
                    <( + + + .-.-./      (  _.-'' '   /   `.       (+ + + + +  (_//      ||
                     `+MJP..( (( (|       ;"    .'   ;      `.       + + + + ._(_/)      ||
                    '''    __\ \\ \\     ;    .'  .-'         ``-----'+'+'     (_/       '|
                    ..---''   `-'`-'`._.'    _..-'\                     |          /\    /\
                               .  ' `--  '--'      \                    |         /  )  /  \
                               |   /                |                   \    _,,-;   `'- -.:
                               |  |    .---.   .-------.                 _.-' _,'            `.
                              _`  (_.-'     `.((=#=#=#=#)            _.-'                     `.
                                   \         \ ((=#=#=#=)         .-'                  . -.    (
                                    \         \ (#=#=#=#______..-'             /      `.(_.'    \
   '     /'                          \         . =#=#=      .' |                                 .
  /     /'                            \     _^_ . #=       / |                                    \
 /     '                      \        \  .'   `.\        ( \                                      .
.      ;                      `.        \/       \         `. \                                     .\
|     '                        |        (o        )         `.                 /  `-.__\.        _    .
|    '                                   |\      /|          `.              ,'          `.  .  ( \   |
|    |                        ,|         | `----' |           |             /              `\ `. `-' .'
|    |                       /           |        |/           |          .'                 '--\.,-'
|    |                                   |      .-'/           \         /
|    |                                   `.    / .'             )       /
|    |                                    `.  / / |             |+.    /+
|    |                                    `. / / |              |  `+.+'
| .-.|                                    | / /  |              |     /
|'.-.|                                    / / ---.              |    /
''   |                                *-.| |      `--._         |   '.
     |                                 `,| |          _>        | .' |
     |                                   (_(_`-------'          |'   |
     |                                                          |    |
     |.-.   .-.   .-.   .-.   .-.   .-.   .-.   .-.   .-.   .-. | _.-'
     |.-.`-'.-.`-'.-.`-'.-.`-'.-.`-'.-.`-'.-.`-'.-.`-'.-.`-'_.-'
     '   `-'   `-'   `-'   `-'   `-'   `-'   `-'   `-'   `-'
            )" << "\n";
        };


        // Loop de combate para o inimigo atual
        while (jogador.estaVivo() && inimigo->estaVivo()) {
            std::cout << "\n";
            battlePrint("Vida: " + std::to_string(jogador.getVida()) + "/" + std::to_string(jogador.getVidaMax()) + " | Pocoes: " + std::to_string(jogador.getPocoes()) + "\n");
            battlePrint("Inimigo: " + inimigo->getNome() + " | Vida: " + std::to_string(inimigo->getVida()) + "/" + std::to_string(inimigo->getVidaMax()) + "\n");
            
            jogador.processarEfeitos();
            if (!jogador.estaVivo()) break;

            if (jogador.getEfeito().tipo != TipoEfeito::Paralisia) {
                typeText("Escolha uma acao:\n1 - Atacar\n2 - Defender\n3 - Usar Pocao\nOpcao: ", TextSpeed::NORMAL);
                int acao;
                std::cin >> acao;

                switch (acao) {
                    case 1:
                        jogador.atacar(*inimigo);
                        inimigo->aoReceberDano(jogador.getAtaque());
                        break;
                    case 2:
                        jogador.defender();
                        break;
                    case 3:
                        jogador.usarPocao();
                        break;
                    default:
                        battlePrint("Acao invalida. Voce perdeu o turno!\n");
                        std::cin.clear();
                        std::cin.ignore(std::numeric_limits<std::streamsize>::max(), '\n');
                        break;
                }
            }

            // A lógica de ataque do inimigo é controlada por aoAtacar() para suportar a reflexão de dano.
            if (inimigo->estaVivo()) {
                // 1. Executa a habilidade especial (ex: refletir dano, roubar ouro).
                inimigo->aoAtacar(jogador);

                // 2. Executa o ataque de dano normal, a menos que a habilidade já o tenha substituído.
                if (!inimigo->habilidadeSubstituiAtaque()) {
                    inimigo->atacar(jogador);
                }
            }
        }

        // Após o loop de combate, verifica se o inimigo morreu.
        if (!inimigo->estaVivo()) {
            battlePrint(inimigo->getNome() + " foi derrotado!\n");
            
            // >>> AQUI ESTÁ A NOVA LÓGICA DE SPAWN <<<
            // Pede ao inimigo a lista de novos monstros que ele gera ao morrer.
            auto novosInimigos = inimigo->onDeathSpawn();
            
            // Remove o inimigo morto da frente da fila.
            inimigos.erase(inimigos.begin());

            // Se a lista de novos inimigos não estiver vazia, adiciona eles no início da fila de combate.
            if (!novosInimigos.empty()) {
                inimigos.insert(inimigos.begin(), std::make_move_iterator(novosInimigos.begin()), std::make_move_iterator(novosInimigos.end()));
            }
        }
        
        if (!jogador.estaVivo()) {
            break; // Sai do loop principal se o jogador morreu.
        }
    }
}
